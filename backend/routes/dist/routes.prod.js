"use strict";var _require=require("../jwt/checkAuth"),generateToken=_require.generateToken,bcrypt=require("bcrypt"),_require2=require("../Schemas/QuizSchema"),QuizModel=_require2.QuizModel,_require3=require("../Schemas/UserSchema"),UserModel=_require3.UserModel,userRegister=function(e,r){var s=bcrypt.hashSync(e.body.password,10),t=new UserModel({email:e.body.email,password:s,name:e.body.name,surName:e.body.surName});try{t.save().then(function(){r.send("user added")}).catch(function(e){r.send("User with this email already registered ")})}catch(e){r.status(400).json(e),console.log(e)}},userAuth=function(r,s){var t,a,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(UserModel.findOne({email:r.body.email}));case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",s.status(401).json({message:"Email or password incorect"}));case 5:a=bcrypt.compareSync(r.body.password,t.password),t&&a?(n=generateToken(t),s.json({token:n})):s.status(401).json({message:"Email or password incorect"});case 7:case"end":return e.stop()}})},createQuiz=function(r,s){var t,a,n,o,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:t=r.body,a=t.title,n=t.subtitle,o=t.Class,u=t.questions;try{new QuizModel({title:a,subtitle:n,Class:o,questions:u,accessCode:Math.floor(8999*Math.random()+1e3)}).save().catch(function(e){return s.status(400).send("Error: "+e)}),s.json("quiz added")}catch(e){s.status(400).json(e),console.log(e)}case 2:case"end":return e.stop()}})};module.exports.userRegister=userRegister,module.exports.createQuiz=createQuiz,module.exports.userAuth=userAuth;